import{y as D,_ as se,d as ne,r as p,a as oe,k as le,b as V,c as s,w as a,M as i,C as $,h as A,j as n,o as r,p as c,m as _,t as B,q as m,F as ie,D as re,u as T,G as ce,H as de,J as pe,K as _e,e as z}from"./index.545fc33e.js";const me=d=>D.post("/wx/auth/ak/create",d),Fe=()=>D.get("/wx/auth/ak/list"),ye=(d,g)=>D.put(`/wx/auth/ak/${d}`,g),Ae=d=>D.post(`/wx/auth/ak/${d}/deactivate`),fe=d=>D.delete(`/wx/auth/ak/${d}`);const ve={class:"ak-management"},Be={key:0,class:"text-gray"},De=ne({__name:"AccessKeyManagement",setup(d){const g=[{title:"AK \u540D\u79F0",dataIndex:"name"},{title:"Access Key",dataIndex:"key",width:"20%",ellipsis:!0},{title:"\u6743\u9650",dataIndex:"permissions",width:"15%"},{title:"\u72B6\u6001",slotName:"status"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",width:"12%"},{title:"\u6700\u540E\u4F7F\u7528",dataIndex:"last_used_at",width:"12%"},{title:"\u64CD\u4F5C",slotName:"action",width:"10%"}],K=p([]),E=p(!1),l=p(""),F=p(!1),f=p("\u521B\u5EFA Access Key"),C=p(null),w=p(!1),o=oe({name:"",description:"",permissions:[],expires_in_days:null}),M=[{label:"\u8BFB",value:"read"},{label:"\u5199",value:"write"},{label:"\u5220\u9664",value:"delete"},{label:"\u7BA1\u7406",value:"admin"}],x=async()=>{try{E.value=!0,l.value="";const e=await Fe();K.value=e||[]}catch(e){l.value=e instanceof Error?e.message:"\u83B7\u53D6 Access Key \u5217\u8868\u5931\u8D25"}finally{E.value=!1}},N=()=>{f.value="\u521B\u5EFA Access Key",C.value=null,w.value=!1,Object.assign(o,{name:"",description:"",permissions:[],expires_in_days:null}),F.value=!0},U=e=>{f.value="\u7F16\u8F91 Access Key",C.value=e,w.value=!1,Object.assign(o,{name:e.name,description:e.description,permissions:e.permissions||[],expires_in_days:null}),F.value=!0},I=async()=>{try{if(!o.name.trim()){i.error("\u8BF7\u8F93\u5165 Access Key \u540D\u79F0");return}if(f.value==="\u521B\u5EFA Access Key"){const e=await me(o);e&&e.secret&&($.info({title:"\u521B\u5EFA\u6210\u529F",content:A("div",[A("p","\u8BF7\u59A5\u5584\u4FDD\u7BA1 Secret Key\uFF0C\u5B83\u53EA\u4F1A\u663E\u793A\u4E00\u6B21\uFF01"),A("p",[A("strong","Access Key: "),e.key]),A("p",[A("strong","Secret Key: "),e.secret])]),okText:"\u6211\u5DF2\u8BB0\u4E0B",onOk:()=>{navigator.clipboard.writeText(`Access Key: ${e.key}
Secret Key: ${e.secret}`).then(()=>{i.success("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{i.error("\u590D\u5236\u5931\u8D25")})}}),w.value=!1)}else C.value&&(await ye(C.value.id,{name:o.name,description:o.description,permissions:o.permissions}),i.success("\u66F4\u65B0\u6210\u529F"));F.value=!1,x()}catch(e){l.value=e instanceof Error?e.message:"\u64CD\u4F5C\u5931\u8D25",i.error(l.value)}},j=e=>{$.confirm({title:"\u505C\u7528 Access Key",content:`\u786E\u5B9A\u8981\u505C\u7528 "${e.name}" \u5417\uFF1F\u505C\u7528\u540E\u5C06\u65E0\u6CD5\u4F7F\u7528\u6B64\u5BC6\u94A5\u8FDB\u884C\u8BA4\u8BC1\u3002`,okText:"\u505C\u7528",cancelText:"\u53D6\u6D88",okButtonProps:{status:"warning"},onOk:async()=>{try{await Ae(e.id),i.success("\u5DF2\u505C\u7528"),x()}catch(u){l.value=u instanceof Error?u.message:"\u505C\u7528\u5931\u8D25",i.error(l.value)}}})},L=e=>{$.confirm({title:"\u5220\u9664 Access Key",content:`\u786E\u5B9A\u8981\u5220\u9664 "${e.name}" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\u3002`,okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",okButtonProps:{status:"danger"},onOk:async()=>{try{await fe(e.id),i.success("\u5DF2\u5220\u9664"),x()}catch(u){l.value=u instanceof Error?u.message:"\u5220\u9664\u5931\u8D25",i.error(l.value)}}})},P=e=>{navigator.clipboard.writeText(e).then(()=>{i.success("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{i.error("\u590D\u5236\u5931\u8D25")})},S=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN")}catch{return"-"}},q=e=>e.is_active?e.is_expired?"orange":"green":"red",G=e=>e.is_active?e.is_expired?"\u5DF2\u8FC7\u671F":"\u6D3B\u8DC3":"\u5DF2\u505C\u7528";return le(()=>{x()}),(e,u)=>{const v=n("a-button"),b=n("a-alert"),O=n("a-tag"),h=n("a-space"),H=n("a-doption"),J=n("a-dropdown"),Q=n("a-popconfirm"),R=n("a-table"),W=n("a-empty"),X=n("a-card"),Y=n("a-input"),k=n("a-form-item"),Z=n("a-textarea"),ee=n("a-checkbox-group"),ue=n("a-input-number"),te=n("a-form"),ae=n("a-modal");return r(),V("div",ve,[s(X,{title:"Access Key \u7BA1\u7406",bordered:!1},{extra:a(()=>[s(v,{type:"primary",onClick:N},{default:a(()=>u[7]||(u[7]=[c("+ \u521B\u5EFA Access Key")])),_:1,__:[7]})]),default:a(()=>[s(h,{direction:"vertical",fill:""},{default:a(()=>[l.value?(r(),_(b,{key:0,type:"error","show-icon":"",closable:"",onClose:u[0]||(u[0]=t=>l.value="")},{default:a(()=>[c(B(l.value),1)]),_:1})):m("",!0),s(b,{type:"info","show-icon":""},{default:a(()=>u[8]||(u[8]=[c(" Access Key \u7528\u4E8E\u7A0B\u5E8F\u5316\u8BBF\u95EE API\u3002\u8BF7\u59A5\u5584\u4FDD\u7BA1 Secret Key\uFF0C\u5B83\u53EA\u4F1A\u5728\u521B\u5EFA\u65F6\u663E\u793A\u4E00\u6B21\u3002 ")])),_:1,__:[8]}),s(R,{columns:g,data:K.value,loading:E.value,"row-key":"id",pagination:!1,scroll:{x:1200}},{permissions:a(({record:t})=>[s(h,{size:"small"},{default:a(()=>[(r(!0),V(ie,null,re(t.permissions,y=>(r(),_(O,{key:y,size:"small"},{default:a(()=>[c(B(y),1)]),_:2},1024))),128)),!t.permissions||t.permissions.length===0?(r(),V("span",Be," \u65E0\u9650\u5236 ")):m("",!0)]),_:2},1024)]),status:a(({record:t})=>[s(O,{color:q(t)},{default:a(()=>[c(B(G(t)),1)]),_:2},1032,["color"])]),created_at:a(({record:t})=>[c(B(S(t.created_at)),1)]),last_used_at:a(({record:t})=>[c(B(S(t.last_used_at)),1)]),action:a(({record:t})=>[s(h,{size:"small"},{default:a(()=>[t.key?(r(),_(v,{key:0,type:"text",size:"small",onClick:y=>P(t.key)},{icon:a(()=>[s(T(ce))]),_:2},1032,["onClick"])):m("",!0),t.is_active?(r(),_(v,{key:1,type:"text",size:"small",onClick:y=>U(t)},{icon:a(()=>[s(T(de))]),_:2},1032,["onClick"])):m("",!0),t.is_active?(r(),_(J,{key:2},{default:a(()=>[s(v,{type:"text",size:"small"},{default:a(()=>u[9]||(u[9]=[c("\u66F4\u591A")])),_:1,__:[9]})]),content:a(()=>[s(H,{onClick:y=>j(t)},{default:a(()=>u[10]||(u[10]=[c("\u505C\u7528")])),_:2,__:[10]},1032,["onClick"])]),_:2},1024)):m("",!0),s(Q,{content:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u5220\u9664","cancel-text":"\u53D6\u6D88",onOk:y=>L(t)},{default:a(()=>[s(v,{type:"text",size:"small",status:"danger"},{icon:a(()=>[s(T(pe))]),_:1})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1},8,["data","loading"]),!E.value&&K.value.length===0?(r(),_(W,{key:1,description:"\u6682\u65E0 Access Key"})):m("",!0)]),_:1})]),_:1}),s(ae,{visible:F.value,"onUpdate:visible":u[5]||(u[5]=t=>F.value=t),title:f.value,width:"600px",onOk:I,onCancel:u[6]||(u[6]=t=>F.value=!1)},{default:a(()=>[s(te,{model:o,layout:"vertical"},{default:a(()=>[s(k,{label:"AK \u540D\u79F0",field:"name",required:""},{default:a(()=>[s(Y,{modelValue:o.name,"onUpdate:modelValue":u[1]||(u[1]=t=>o.name=t),placeholder:"\u4F8B\u5982\uFF1A\u751F\u4EA7\u73AF\u5883\u722C\u866B",onKeyup:_e(I,["enter"])},null,8,["modelValue"])]),_:1}),s(k,{label:"\u63CF\u8FF0",field:"description"},{default:a(()=>[s(Z,{modelValue:o.description,"onUpdate:modelValue":u[2]||(u[2]=t=>o.description=t),placeholder:"\u53EF\u9009\uFF1A\u7528\u9014\u8BF4\u660E\u3001\u5907\u6CE8\u7B49",rows:3},null,8,["modelValue"])]),_:1}),s(k,{label:"\u6743\u9650\u8303\u56F4",field:"permissions"},{default:a(()=>[s(ee,{modelValue:o.permissions,"onUpdate:modelValue":u[3]||(u[3]=t=>o.permissions=t),options:M},null,8,["modelValue"]),u[11]||(u[11]=z("div",{class:"form-hint"},"\u4E0D\u9009\u62E9\u4EFB\u4F55\u6743\u9650\u5219\u4F7F\u7528\u8D26\u6237\u9ED8\u8BA4\u6743\u9650",-1))]),_:1,__:[11]}),s(k,{label:"\u8FC7\u671F\u65F6\u95F4",field:"expires_in_days"},{default:a(()=>[s(ue,{modelValue:o.expires_in_days,"onUpdate:modelValue":u[4]||(u[4]=t=>o.expires_in_days=t),placeholder:"\u5929\u6570\uFF08\u7559\u7A7A\u8868\u793A\u6C38\u4E0D\u8FC7\u671F\uFF09",min:1,max:36500},null,8,["modelValue"]),u[12]||(u[12]=z("div",{class:"form-hint"},"\u4E3A\u5B89\u5168\u8D77\u89C1\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u5408\u7406\u7684\u8FC7\u671F\u65F6\u95F4",-1))]),_:1,__:[12]}),f.value==="\u521B\u5EFA Access Key"?(r(),_(b,{key:0,type:"warning","show-icon":""},{default:a(()=>u[13]||(u[13]=[c(" \u521B\u5EFA\u540E\uFF0CSecret Key \u53EA\u4F1A\u663E\u793A\u4E00\u6B21\uFF0C\u8BF7\u59A5\u5584\u4FDD\u7BA1\uFF01 ")])),_:1,__:[13]})):m("",!0)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}});var Ce=se(De,[["__scopeId","data-v-389bc881"]]);export{Ce as default};
